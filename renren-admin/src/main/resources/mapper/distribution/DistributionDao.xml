<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.distribution.dao.DistributionDao">

    <insert id="insertDistribution" parameterType="io.renren.modules.distribution.entity.Distribution">
    INSERT INTO tb_distribution (
	id,
	focus_on_pop,
	focus_on_red,
	share_red_envelopes,
	distribution_series,
	activity_theme,
	trigger_keywords,
	wechat_description,
	thumbnail,
	virtual_popularity,
	music,
	auto_play_music,
	phone,
	target_quantity,
	product_price,
	no_payment_num,
	max_value,
	min_value,
	red_envelopes_name,
	red_envelopes_blessings,
	one_key_concern,
	wechat_pic,
	template_style,
	activity_rules,
	activity_name,
	activity_type,
	start_time,
	end_time,
	update_user,
	activity_state,
	update_time
)
VALUES
	(
		#{id,jdbcType=VARCHAR},
		#{focusOnPop,jdbcType=INTEGER},
		#{focusOnRed,jdbcType=INTEGER},
		#{shareRedEnvelopes,jdbcType=INTEGER},
		#{distributionSeries,jdbcType=INTEGER},
		#{activityTheme,jdbcType=VARCHAR},
		#{triggerKeywords,jdbcType=VARCHAR},
		#{wechatDescription,jdbcType=VARCHAR},
		#{thumbnail,jdbcType=VARCHAR},
		#{virtualPopularity,jdbcType=INTEGER},
		#{music,jdbcType=VARCHAR},
		#{autoPlayMusic,jdbcType=INTEGER},
		#{phone,jdbcType=VARCHAR},
		#{targetQuantity,jdbcType=VARCHAR},
		#{productPrice,jdbcType=VARCHAR},
		#{noPaymentNum,jdbcType=VARCHAR},
		#{maxValue,jdbcType=VARCHAR},
		#{minValue,jdbcType=VARCHAR},
		#{redEnvelopesName,jdbcType=VARCHAR},
		#{redEnvelopesBlessings,jdbcType=VARCHAR},
		#{oneKeyConcern,jdbcType=VARCHAR},
		#{wechatPic,jdbcType=VARCHAR},
		#{templateStyle,jdbcType=VARCHAR},
		#{activityRules,jdbcType=VARCHAR},
		#{activityName,jdbcType=VARCHAR},
		#{activityType,jdbcType=VARCHAR},
		#{startTime,jdbcType=VARCHAR},
		#{endTime,jdbcType=VARCHAR},
		#{updateUser,jdbcType=VARCHAR},
		#{activityState,jdbcType=VARCHAR},
		SYSDATE()
	)
    </insert>
    <select id="queryById" parameterType="java.lang.String"
            resultType="io.renren.modules.distribution.entity.Distribution">
		select * from tb_distribution where id = #{id}
	</select>

    <update id="rollback" parameterType="java.lang.String">
        update tb_distribution
        <set>
            target_quantity = target_quantity + 1,
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <update id="release" parameterType="java.lang.String">
        update tb_distribution
        <set>
            target_quantity = target_quantity - 1,
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>

	<update id="addWatcher" parameterType="io.renren.modules.distribution.entity.Distribution">
		update tb_distribution
		<set>
		<if test="watcher!= null">
			watcher =  concat(concat(#{watcher,jdbcType=VARCHAR},','),IFNULL(watcher,'')),
		</if>
		<if test="visits!= null">
			visits = visits + 1
		</if>
		</set>
		where id = #{id,jdbcType=VARCHAR}
	</update>
</mapper>